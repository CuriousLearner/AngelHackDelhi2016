var message = [

    {
        "total_fav_count": 4,
        "impact_score": 0.2809361438313701,
        "total_retweet_count": 6,
        "twitter_id": "322579876",
        "twitter_username": "CMYK_Bookstore",
        "location": "Delhi",
        "follower_count": 482
    }, {
        "total_fav_count": 1,
        "impact_score": 1.0245040297582144,
        "total_retweet_count": 1,
        "twitter_id": "41448609",
        "twitter_username": "72interactive",
        "location": "Delhi",
        "follower_count": 1785
    }, {
        "total_fav_count": 1,
        "impact_score": 0.07704587724736515,
        "total_retweet_count": 3,
        "twitter_id": "3901029193",
        "twitter_username": "YesMinisterDEL",
        "location": "Delhi",
        "follower_count": 131
    }, {
        "total_fav_count": 17,
        "impact_score": 0.17695288282703037,
        "total_retweet_count": 93,
        "twitter_id": "1535872880",
        "twitter_username": "CraftsMuseum",
        "location": "Delhi",
        "follower_count": 213
    }, {
        "total_fav_count": 3,
        "impact_score": 0.35657160570365776,
        "total_retweet_count": 0,
        "twitter_id": "338207479",
        "twitter_username": "KhushiiNGO",
        "location": "Delhi",
        "follower_count": 620
    }, {
        "total_fav_count": 0,
        "impact_score": 0.4359268443893366,
        "total_retweet_count": 35,
        "twitter_id": "300139955",
        "twitter_username": "HCFIIndia",
        "location": "Delhi",
        "follower_count": 728
    }, {
        "total_fav_count": 9,
        "impact_score": 0.23750774953502787,
        "total_retweet_count": 27,
        "twitter_id": "433254606",
        "twitter_username": "Area79Festival",
        "location": "Delhi",
        "follower_count": 384
    }, {
        "total_fav_count": 4,
        "impact_score": 0.704959702417855,
        "total_retweet_count": 1,
        "twitter_id": "523100450",
        "twitter_username": "webexpertzin",
        "location": "Delhi",
        "follower_count": 1226
    }, {
        "total_fav_count": 0,
        "impact_score": 0.38130812151270926,
        "total_retweet_count": 1,
        "twitter_id": "1871174502",
        "twitter_username": "monkeybardel",
        "location": "Delhi",
        "follower_count": 664
    }, {
        "total_fav_count": 5,
        "impact_score": 0.6267823930564167,
        "total_retweet_count": 0,
        "twitter_id": "1229742769",
        "twitter_username": "Neeraj_Lavaniya",
        "location": "Delhi",
        "follower_count": 1090
    }, {
        "total_fav_count": 2,
        "impact_score": 0.7495815251084935,
        "total_retweet_count": 1,
        "twitter_id": "1922443320",
        "twitter_username": "WebDesignSUMO",
        "location": "Delhi",
        "follower_count": 1305
    }, {
        "total_fav_count": 0,
        "impact_score": 0.060725356478611284,
        "total_retweet_count": 63,
        "twitter_id": "262609360",
        "twitter_username": "harishri_India",
        "location": "Delhi",
        "follower_count": 48
    }, {
        "total_fav_count": 4,
        "impact_score": 0.1911810291382517,
        "total_retweet_count": 0,
        "twitter_id": "49670842",
        "twitter_username": "Paharpur",
        "location": "Delhi",
        "follower_count": 331
    }, {
        "total_fav_count": 34,
        "impact_score": 3.186670799752015,
        "total_retweet_count": 29,
        "twitter_id": "71776841",
        "twitter_username": "SelectCITYWALK",
        "location": "Delhi",
        "follower_count": 5510
    }, {
        "total_fav_count": 63,
        "impact_score": 5.809345939243645,
        "total_retweet_count": 15,
        "twitter_id": "167632572",
        "twitter_username": "JobsAtGates",
        "location": "Delhi",
        "follower_count": 10079
    }, {
        "total_fav_count": 7,
        "impact_score": 0.506633601983881,
        "total_retweet_count": 21,
        "twitter_id": "505759060",
        "twitter_username": "WestinGurgaonND",
        "location": "Delhi",
        "follower_count": 860
    }, {
        "total_fav_count": 37,
        "impact_score": 0.6111748295102294,
        "total_retweet_count": 77,
        "twitter_id": "1142153167",
        "twitter_username": "jiviteshhotel",
        "location": "Delhi",
        "follower_count": 973
    }, {
        "total_fav_count": 1,
        "impact_score": 0.23546187228766274,
        "total_retweet_count": 0,
        "twitter_id": "259749007",
        "twitter_username": "cprohini",
        "location": "Delhi",
        "follower_count": 410
    }, {
        "total_fav_count": 15,
        "impact_score": 0.31818040917544943,
        "total_retweet_count": 1,
        "twitter_id": "2245532845",
        "twitter_username": "eroshotelnd",
        "location": "Delhi",
        "follower_count": 545
    }, {
        "total_fav_count": 4,
        "impact_score": 2.176208927464352,
        "total_retweet_count": 130,
        "twitter_id": "2156462822",
        "twitter_username": "WeMark_India",
        "location": "Delhi",
        "follower_count": 3673
    }, {
        "total_fav_count": 0,
        "impact_score": 0.01032238065716057,
        "total_retweet_count": 0,
        "twitter_id": "2766103682",
        "twitter_username": "LiquorShopDelhi",
        "location": "Delhi",
        "follower_count": 18
    }, {
        "total_fav_count": 2,
        "impact_score": 0.4799597024178549,
        "total_retweet_count": 3,
        "twitter_id": "140086004",
        "twitter_username": "RadialHR",
        "location": "Delhi",
        "follower_count": 833
    }, {
        "total_fav_count": 20,
        "impact_score": 1.298171109733416,
        "total_retweet_count": 2,
        "twitter_id": "78870857",
        "twitter_username": "induswebi",
        "location": "Delhi",
        "follower_count": 2250
    }, {
        "total_fav_count": 2,
        "impact_score": 5.308880967141972,
        "total_retweet_count": 9073,
        "twitter_id": "154526188",
        "twitter_username": "pranitarottmann",
        "location": "Delhi",
        "follower_count": 919
    }, {
        "total_fav_count": 4,
        "impact_score": 0.887569745815251,
        "total_retweet_count": 933,
        "twitter_id": "44605684",
        "twitter_username": "ErSanyamKhurana",
        "location": "New Delhi",
        "follower_count": 688
    }, {
        "total_fav_count": 6,
        "impact_score": 0.14747365158090514,
        "total_retweet_count": 5,
        "twitter_id": "447875983",
        "twitter_username": "slayslot",
        "location": "New Delhi, India ",
        "follower_count": 249
    }, {
        "total_fav_count": 5,
        "impact_score": 0.39032858028518286,
        "total_retweet_count": 300,
        "twitter_id": "15089974",
        "twitter_username": "st",
        "location": "europe",
        "follower_count": 402
    }

]
var k_score = 0;
var k_retweet = 0;
var k_favorites = 0;
var k_follower = 0;
var config0 = liquidFillGaugeDefaultSettings();
config0.textVertPosition = 0.8;
config0.waveAnimateTime = 5000;
config0.waveHeight = 0.15;
config0.waveOffset = 0.25;
config0.valueCountUp = false;
config0.displayPercent = false;
config0.waveAnimateTime = 1000;
var gauge1 = loadLiquidFillGauge("fillgauge1", 3, config0);
var config1 = liquidFillGaugeDefaultSettings();
config1.textVertPosition = 0.8;
config1.waveAnimateTime = 5000;
config1.waveHeight = 0.15;
config1.waveOffset = 0.25;
config1.valueCountUp = false;
config1.displayPercent = false;
config1.waveAnimateTime = 1000;
var gauge2 = loadLiquidFillGauge("fillgauge2", 1000, config1);
var config2 = liquidFillGaugeDefaultSettings();
config2.textVertPosition = 0.8;
config2.waveAnimateTime = 5000;
config2.waveHeight = 0.15;
config2.waveOffset = 0.25;
config2.valueCountUp = false;
config2.displayPercent = false;
config2.waveAnimateTime = 1000;
var gauge3 = loadLiquidFillGauge("fillgauge3", 2000, config2);
var config3 = liquidFillGaugeDefaultSettings();
config3.textVertPosition = 0.8;
config3.waveAnimateTime = 5000;
config3.waveHeight = 0.15;
config3.waveOffset = 0.25;
config3.valueCountUp = false;
config3.displayPercent = false;
config3.waveAnimateTime = 1000;
var gauge4 = loadLiquidFillGauge("fillgauge4", 50, config3);

function NewValueImpactScore() {

    var max_impact_score = 0;
    var min_impact_score = 100;
    var total_impact_score = 0;
    $.each(message, function(i, e) {
      if (max_impact_score < message[i].impact_score) {
          max_impact_score = message[i].impact_score;
          config0.maxValue = max_impact_score * 1.1;
      }
      if (min_impact_score > message[i].impact_score) {
          min_impact_score = message[i].impact_score;
          config0.minValue = min_impact_score;
      }
      total_impact_score = total_impact_score + message[i].impact_score;
    });
    var avg_impact_score = total_impact_score / message.length;
    console.log(max_impact_score)
    if (k_score == 0) {
        k_score++;
        document.getElementById("score_title").innerHTML = "MAXIMUM SCORE"
        return max_impact_score;
    } else if (k_score == 1) {
        k_score++;
        document.getElementById("score_title").innerHTML = "MINIMUM SCORE"
        console.log('minimum')
        return min_impact_score;
    } else if (k_score == 2) {
        k_score = 0;
        document.getElementById("score_title").innerHTML = "AVERAGE SCORE"
        return avg_impact_score;
    }

}

function NewValueRetweet() {

    var max_retweet = 0;
    var min_retweet = 50000;
    var total_retweet = 0;
    $.each(message, function(i, e) {
      if (max_retweet < message[i].total_retweet_count) {
          max_retweet = message[i].total_retweet_count;
          config1.maxValue = max_retweet * 1.1;
      }
      if (min_retweet > message[i].total_retweet_count) {
          min_retweet = message[i].total_retweet_count;
          config1.minValue = min_retweet;
      }
      total_retweet = total_retweet + message[i].total_retweet_count;
    });
    var avg_retweet = total_retweet / message.length;
    console.log(max_retweet)
    if (k_retweet == 0) {
        document.getElementById("retweet_title").innerHTML = "MAXIMUM RETWEET"
        k_retweet++;
        return max_retweet;
    } else if (k_retweet == 1) {
        k_retweet++;
        document.getElementById("retweet_title").innerHTML = "MINIMUM RETWEET"
        console.log('minimum')
        return min_retweet;
    } else if (k_retweet == 2) {
        k_retweet = 0;
        document.getElementById("retweet_title").innerHTML = "AVERAGE RETWEET"
        return Math.round(avg_retweet);
    }

}

//total favorites

function NewValueFavorite() {

    var max_favorites = 0;
    var min_favorites = 100;
    var total_favorites = 0;
    $.each(message, function(i, e) {
      if (max_favorites < message[i].total_fav_count) {
          max_favorites = message[i].total_fav_count;
          config2.maxValue = max_favorites * 1.1;
      }
      if (min_favorites > message[i].total_fav_count) {
          min_favorites = message[i].total_fav_count;
          config2.minValue = min_favorites;
      }
      total_favorites = total_favorites + message[i].total_fav_count;
    });
    var avg_favorites = total_favorites / message.length;
    console.log(avg_favorites)
    if (k_favorites == 0) {

        k_favorites++;
        document.getElementById("favorites_title").innerHTML = "MAXIMUM FAVORITES"
        return max_favorites;
    } else if (k_favorites == 1) {
        k_favorites++;
        document.getElementById("favorites_title").innerHTML = "MINIMUM FAVORITES"
        console.log('minimum')
        return min_favorites;
    } else if (k_favorites == 2) {
        k_favorites = 0;
        document.getElementById("favorites_title").innerHTML = "AVERAGE FAVORITES"
        return Math.round(avg_favorites);
    }

}

function NewValueFollower() {

    var max_follower = 0;
    var min_follower = 100;
    var total_follower = 0;
    $.each(message, function(i, e) {
      if (max_follower < message[i].follower_count) {
          max_follower = message[i].follower_count;
          config3.maxValue = max_follower * 1.1;
      }
      if (min_follower > message[i].follower_count) {
          min_follower = message[i].follower_count;
          config3.minValue = min_follower;
      }
      total_follower = total_follower + message[i].follower_count;
    });
    var avg_follower = total_follower / message.length;
    console.log(avg_follower)
    if (k_follower == 0) {
        k_follower++;
        document.getElementById("follower_title").innerHTML = "MAXIMUM FOLLOWER"
        return max_follower;
    } else if (k_follower == 1) {
        k_follower++;
        document.getElementById("follower_title").innerHTML = "MINIMUM FOLLOWER"
        console.log('minimum')
        return min_follower;
    } else if (k_follower == 2) {
        document.getElementById("follower_title").innerHTML = "AVERAGE FOLLOWER"
        k_follower = 0;
        return Math.round(avg_follower);
    }

}

var cardTemplate = $("#card-template").html();

$(document).ready(function() {
    $('.visual').hide();
    $('.visual-down').hide();
    $('.back').hide();
    $('.dynamic').hide();
    $('.visual-up').hide();
    $(document.body).on('click', '.back',
        function() {
            $('.visual').hide();
            $('.back').hide();
            $('.dynamic').hide();
            $('.form-wrapper').show();
            $('.visual-down').hide();
            $('.visual-up').hide();
        });
    $(document).keyup(function(e) {
        if (e.keyCode == 27) { // escape key maps to keycode `27`
            $('.visual').hide();
            $('.back').hide();
            $('.dynamic').hide();
            $('.form-wrapper').show();
            $('.visual-down').hide();
            $('.visual-up').hide();
            $('#handle').val('');
        }
    });
    $(document.body).on('click', '.visual-down',
        function() {
            $('.visual').show();
            $('.back').show();
            $('.dynamic').hide();
            $('.form-wrapper').hide();
            $('.visual-down').hide();
            $('.visual-up').show();
        });
    $(document).keyup(function(e) {
        if (e.keyCode == 40) { // down key maps to keycode `40`
            $('.visual').show();
            $('.back').show();
            $('.dynamic').hide();
            $('.form-wrapper').hide();
            $('.visual-down').hide();
            $('.visual-up').show();
        }
    });
    $(document.body).on('click', '.visual-up',
        function() {
            $('.visual').hide();
            $('.back').show();
            $('.dynamic').show();
            $('.form-wrapper').hide();
            $('.visual-down').show();
            $('.visual-up').hide();
        });
    $(document).keyup(function(e) {
        if (e.keyCode == 38) { // up key maps to keycode `38`
            $('.visual').hide();
            $('.back').show();
            $('.dynamic').show();
            $('.form-wrapper').hide();
            $('.visual-down').show();
            $('.visual-up').hide();
        }
    });
    $('#handle').keypress(function(e) {
        var key = e.which;
        if (key == 13) // the enter key code
        {
            var text = $(this).val();
            $(this).val('');
            //requestData(text);
            handleSearch(message, text);
        }
    });
    $('#handleSubmit').click(function() {
        var text = $('#handle').val();
        $('#handle').val('');
        //requestData(text);
        handleSearch(message, text);
    });

    // function requestData(handlename) {
    //     var request = $.ajax({
    //         url: "http://stormy-gorge-8134.herokuapp.com/getimpact/"+handlename+"/,
    //         method: "GET",
    //         dataType: "json"
    //     });
    //     request.done(function(msg) {
    //         if (msg.length == 0) {
    //             alert('Nothing here');
    //             $('<h2 class="text-center">Houston, we have nothing here.<b>Stay tuned.</b></h2>').appendTo('.single-event');
    //         } else {
    //             handleSearch(msg,handlename);
    //         }
    //     });
    //
    //     request.fail(function(jqXHR, textStatus) {
    //         $('<h2 class="text-center">Houston, our server has faced some unexpected error.<b>Stay tuned.</b></h2>').appendTo('.single-event');
    //         console.log("Request failed: " + textStatus);
    //     });
    // }
    function handleSearch(message, handlename) {
        $('.dynamic').empty();
        $('.dynamic').show();
        $('.form-wrapper').hide();
        $('.visual-up').hide();
        $.each(message, function(i, e) {
            if (message[i].twitter_username == handlename) {
                var adddata = cardTemplate.replace('userhandle">', 'userhandle">' + message[i].twitter_username);
                adddata = adddata.replace('location">', 'location">' + message[i].location);
                adddata = adddata.replace('impactScore">0.', 'impactScore">0.' + Math.round(message[i].impact_score * 10000));
                adddata = adddata.replace('favorites">', 'favorites">' + message[i].total_fav_count);
                adddata = adddata.replace('rts">', 'rts">' + message[i].total_retweet_count);
                adddata = adddata.replace('followers">', 'followers">' + message[i].follower_count);
                $(adddata).appendTo('.dynamic');
                $('.back').show();
                $('.visual-down').show();
            }
        });
    }
});
